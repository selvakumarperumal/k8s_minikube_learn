# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘           KUBERNETES STATEFULSET - COMPLETE LEARNING GUIDE                â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# This file demonstrates:
# 1. Headless Service for stable network identity
# 2. StatefulSet with ordered pod creation
# 3. Persistent storage per pod (PVC templates)
# 4. Stable pod naming and DNS
#
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚                          TABLE OF CONTENTS                                  â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚  1. HEADLESS SERVICE EXPLAINED (START HERE!)                                â”‚
# â”‚  2. What is a StatefulSet?                                                  â”‚
# â”‚  3. StatefulSet vs Deployment                                               â”‚
# â”‚  4. Architecture Diagram                                                    â”‚
# â”‚  5. Pod Creation Flow                                                       â”‚
# â”‚  6. DNS and Network Identity                                                â”‚
# â”‚  7. Persistent Storage                                                      â”‚
# â”‚  8. Headless Service Configuration                                          â”‚
# â”‚  9. StatefulSet Configuration                                               â”‚
# â”‚  10. Useful kubectl Commands                                                â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘              1. HEADLESS SERVICE EXPLAINED (START HERE!)                  â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   ğŸ¯ THE SIMPLE ANSWER:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   A headless service is a service WITHOUT a ClusterIP (virtual IP address).
#   Instead of load balancing, it returns the IP addresses of individual pods.
#
#   KEY DIFFERENCE:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Normal Service (ClusterIP):  "Give me ONE IP that load balances to all pods"
#   Headless Service (None):     "Give me ALL pod IPs, I'll choose which one"
#
#
#   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
#   â•‘                    NORMAL SERVICE vs HEADLESS SERVICE                 â•‘
#   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   NORMAL SERVICE (ClusterIP: 10.96.0.10)
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   Client Application
#        â”‚
#        â”‚ DNS Query: "What is my-service?"
#        â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚  DNS Server                         â”‚
#   â”‚  Returns: 10.96.0.10 (ClusterIP)    â”‚  â† Single virtual IP
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#        â”‚
#        â”‚ Connect to 10.96.0.10
#        â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚  Service: my-service                â”‚
#   â”‚  ClusterIP: 10.96.0.10              â”‚  â† Load Balancer
#   â”‚  Type: ClusterIP                    â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#                  â”‚
#                  â”‚ Randomly picks ONE pod
#                  â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚  Pod 1        Pod 2        Pod 3                 â”‚
#   â”‚  10.244.0.5   10.244.0.6   10.244.0.7            â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   Result: Client connects to 10.96.0.10, service forwards to random pod
#
#
#   HEADLESS SERVICE (ClusterIP: None)
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   Client Application
#        â”‚
#        â”‚ DNS Query: "What is my-headless-service?"
#        â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚  DNS Server                         â”‚
#   â”‚  Returns:                           â”‚  â† ALL pod IPs!
#   â”‚  â€¢ 10.244.0.5 (pod-0)               â”‚
#   â”‚  â€¢ 10.244.0.6 (pod-1)               â”‚
#   â”‚  â€¢ 10.244.0.7 (pod-2)               â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#        â”‚
#        â”‚ Client chooses which pod to connect to
#        â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚  Pod 1        Pod 2        Pod 3                 â”‚
#   â”‚  10.244.0.5   10.244.0.6   10.244.0.7            â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   Result: Client gets all pod IPs and connects directly to specific pod
#
#
#   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
#   â•‘                    WHY USE HEADLESS SERVICE?                          â•‘
#   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   REASON 1: Direct Pod Access
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   â€¢ You want to connect to a SPECIFIC pod, not a random one
#   â€¢ Example: Database primary/replica - you need to know which is which
#
#   REASON 2: Service Discovery
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   â€¢ Application needs to discover all pod IPs
#   â€¢ Example: Distributed system where nodes need to find each other
#
#   REASON 3: StatefulSet Requirement
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   â€¢ StatefulSets REQUIRE headless service for stable DNS names
#   â€¢ Each pod gets: pod-name.service-name.namespace.svc.cluster.local
#
#   REASON 4: Client-Side Load Balancing
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   â€¢ Application implements its own load balancing logic
#   â€¢ Example: gRPC clients that maintain connections to all pods
#
#
#   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
#   â•‘                    PRACTICAL EXAMPLE: DATABASE                        â•‘
#   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   Scenario: PostgreSQL with 1 Primary + 2 Replicas
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   With NORMAL Service (BAD for databases):
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Client â†’ Service (ClusterIP) â†’ Random pod
#
#   Problem:
#   â”œâ”€ Write query might go to replica (ERROR!)
#   â”œâ”€ Read query might go to primary (inefficient)
#   â””â”€ No way to target specific pod
#
#
#   With HEADLESS Service (GOOD for databases):
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   Pods:
#   â”œâ”€ postgres-0 (Primary)   â†’ postgres-0.postgres-service
#   â”œâ”€ postgres-1 (Replica)   â†’ postgres-1.postgres-service
#   â””â”€ postgres-2 (Replica)   â†’ postgres-2.postgres-service
#
#   Client can:
#   â”œâ”€ Write queries â†’ postgres-0.postgres-service (always primary)
#   â”œâ”€ Read queries  â†’ postgres-1.postgres-service (replica)
#   â””â”€ Read queries  â†’ postgres-2.postgres-service (replica)
#
#   Result: Full control over which pod handles which request!
#
#
#   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
#   â•‘                    DNS BEHAVIOR COMPARISON                            â•‘
#   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   Setup:
#   â”€â”€â”€â”€â”€â”€
#   3 nginx pods: web-0, web-1, web-2
#   Service name: nginx-service
#   Namespace: default
#
#
#   NORMAL SERVICE (ClusterIP: 10.96.0.50)
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   DNS Query: nginx-service.default.svc.cluster.local
#   Result: 10.96.0.50 (single ClusterIP)
#
#   DNS Query: web-0.nginx-service.default.svc.cluster.local
#   Result: NOT FOUND (individual pod DNS doesn't exist)
#
#   Connection:
#   â””â”€ curl http://nginx-service â†’ Goes to random pod
#
#
#   HEADLESS SERVICE (ClusterIP: None)
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   DNS Query: nginx-service.default.svc.cluster.local
#   Result:
#   â”œâ”€ 10.244.0.10 (web-0)
#   â”œâ”€ 10.244.0.11 (web-1)
#   â””â”€ 10.244.0.12 (web-2)
#
#   DNS Query: web-0.nginx-service.default.svc.cluster.local
#   Result: 10.244.0.10 (specific pod IP)
#
#   DNS Query: web-1.nginx-service.default.svc.cluster.local
#   Result: 10.244.0.11 (specific pod IP)
#
#   Connection:
#   â”œâ”€ curl http://web-0.nginx-service â†’ Always web-0
#   â”œâ”€ curl http://web-1.nginx-service â†’ Always web-1
#   â””â”€ curl http://web-2.nginx-service â†’ Always web-2
#
#
#   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
#   â•‘                    HANDS-ON DEMONSTRATION                             â•‘
#   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   Let's see the difference in action!
#
#   Step 1: Create Normal Service
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   apiVersion: v1
#   kind: Service
#   metadata:
#     name: normal-service
#   spec:
#     selector:
#       app: nginx
#     ports:
#     - port: 80
#     # clusterIP is auto-assigned (e.g., 10.96.0.50)
#
#   Test:
#   $ kubectl run test --rm -it --image=busybox -- sh
#   # nslookup normal-service
#   Server:    10.96.0.10
#   Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local
#
#   Name:      normal-service
#   Address 1: 10.96.0.50 normal-service.default.svc.cluster.local
#                          â†‘
#                          Single ClusterIP
#
#
#   Step 2: Create Headless Service
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   apiVersion: v1
#   kind: Service
#   metadata:
#     name: headless-service
#   spec:
#     clusterIP: None  â† This makes it headless!
#     selector:
#       app: nginx
#     ports:
#     - port: 80
#
#   Test:
#   $ kubectl run test --rm -it --image=busybox -- sh
#   # nslookup headless-service
#   Server:    10.96.0.10
#   Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local
#
#   Name:      headless-service
#   Address 1: 10.244.0.10 web-0.headless-service.default.svc.cluster.local
#   Address 2: 10.244.0.11 web-1.headless-service.default.svc.cluster.local
#   Address 3: 10.244.0.12 web-2.headless-service.default.svc.cluster.local
#                          â†‘
#                          All pod IPs!
#
#
#   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
#   â•‘                    WHEN TO USE EACH TYPE                              â•‘
#   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   USE NORMAL SERVICE (ClusterIP) WHEN:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   âœ“ Stateless applications (web servers, APIs)
#   âœ“ You want automatic load balancing
#   âœ“ Pods are interchangeable
#   âœ“ You don't care which pod handles the request
#
#   Examples:
#   â€¢ REST API backends
#   â€¢ Stateless web applications
#   â€¢ Microservices
#
#
#   USE HEADLESS SERVICE (clusterIP: None) WHEN:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   âœ“ Stateful applications (databases, caches)
#   âœ“ You need to connect to specific pods
#   âœ“ Using StatefulSets
#   âœ“ Pods have unique identities/roles
#   âœ“ Client-side load balancing
#
#   Examples:
#   â€¢ Databases (PostgreSQL, MySQL, MongoDB)
#   â€¢ Message queues (Kafka, RabbitMQ)
#   â€¢ Distributed systems (etcd, Consul, Zookeeper)
#   â€¢ Caching systems (Redis, Memcached)
#
#
#   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
#   â•‘                    QUICK REFERENCE                                    â•‘
#   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚   Feature          â”‚   Normal Service    â”‚   Headless Service       â”‚
#   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
#   â”‚ clusterIP          â”‚ Auto-assigned IP    â”‚ None                     â”‚
#   â”‚ Load Balancing     â”‚ Yes (automatic)     â”‚ No (client chooses)      â”‚
#   â”‚ DNS Returns        â”‚ Single ClusterIP    â”‚ All pod IPs              â”‚
#   â”‚ Pod DNS Names      â”‚ No                  â”‚ Yes (pod.service.ns)     â”‚
#   â”‚ Use Case           â”‚ Stateless apps      â”‚ Stateful apps            â”‚
#   â”‚ StatefulSet        â”‚ Not compatible      â”‚ Required                 â”‚
#   â”‚ Direct Pod Access  â”‚ No                  â”‚ Yes                      â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   YAML Comparison:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   Normal Service:              Headless Service:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   apiVersion: v1               apiVersion: v1
#   kind: Service                kind: Service
#   metadata:                    metadata:
#     name: my-service             name: my-service
#   spec:                        spec:
#     selector:                    clusterIP: None  â† Only difference!
#       app: nginx                 selector:
#     ports:                         app: nginx
#     - port: 80                   ports:
#                                  - port: 80
#
#
#   ğŸ’¡ REMEMBER:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Headless = clusterIP: None = No load balancing = Direct pod access
#
#
#
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                      1. WHAT IS A STATEFULSET?                            â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   A StatefulSet is a Kubernetes workload controller for managing stateful
#   applications that require:
#
#   âœ“ Stable, unique network identifiers (predictable pod names)
#   âœ“ Stable, persistent storage (each pod gets its own volume)
#   âœ“ Ordered, graceful deployment and scaling
#   âœ“ Ordered, automated rolling updates
#
#   COMMON USE CASES:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   â€¢ Databases (PostgreSQL, MySQL, MongoDB, Cassandra)
#   â€¢ Message queues (Kafka, RabbitMQ, NATS)
#   â€¢ Distributed systems (Zookeeper, etcd, Consul)
#   â€¢ Stateful applications requiring stable identity
#
#
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                   2. STATEFULSET VS DEPLOYMENT                            â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚   Feature            â”‚   Deployment        â”‚   StatefulSet            â”‚
#   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
#   â”‚ Pod Names            â”‚ Random (app-abc123) â”‚ Ordered (app-0, app-1)   â”‚
#   â”‚ Network Identity     â”‚ Unstable            â”‚ Stable DNS names         â”‚
#   â”‚ Storage              â”‚ Shared or none      â”‚ Per-pod persistent       â”‚
#   â”‚ Creation Order       â”‚ Parallel            â”‚ Sequential (ordered)     â”‚
#   â”‚ Scaling              â”‚ Random pods         â”‚ Ordered (0â†’1â†’2)          â”‚
#   â”‚ Updates              â”‚ Random order        â”‚ Reverse order (2â†’1â†’0)    â”‚
#   â”‚ Pod Replacement      â”‚ New name            â”‚ Same name preserved      â”‚
#   â”‚ Use Case             â”‚ Stateless apps      â”‚ Stateful apps            â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   EXAMPLE:
#   â”€â”€â”€â”€â”€â”€â”€â”€
#   Deployment (replicas: 3):          StatefulSet (replicas: 3):
#   â”œâ”€ nginx-7d8b49c8d-abc12           â”œâ”€ web-0 (first, persistent)
#   â”œâ”€ nginx-7d8b49c8d-def34           â”œâ”€ web-1 (second, persistent)
#   â””â”€ nginx-7d8b49c8d-ghi56           â””â”€ web-2 (third, persistent)
#
#   If pod deleted:                    If pod deleted:
#   â””â”€ New random name                 â””â”€ Same name recreated (web-0)
#
#
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                      3. ARCHITECTURE DIAGRAM                              â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   STATEFULSET ARCHITECTURE WITH PORTS
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚                      KUBERNETES CLUSTER                             â”‚
#   â”‚                                                                     â”‚
#   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
#   â”‚  â”‚              Headless Service: nginx-service                  â”‚  â”‚
#   â”‚  â”‚              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚  â”‚
#   â”‚  â”‚              ClusterIP: None (no load balancing)              â”‚  â”‚
#   â”‚  â”‚              Port: 80 (named: web)                            â”‚  â”‚
#   â”‚  â”‚              Provides DNS for individual pods                 â”‚  â”‚
#   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
#   â”‚                             â”‚                                       â”‚
#   â”‚                             â”‚ DNS Resolution                        â”‚
#   â”‚                             â”‚ Returns pod IPs                       â”‚
#   â”‚                             â–¼                                       â”‚
#   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
#   â”‚  â”‚                  StatefulSet: web                             â”‚  â”‚
#   â”‚  â”‚                  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚  â”‚
#   â”‚  â”‚                  Replicas: 3                                  â”‚  â”‚
#   â”‚  â”‚                  Ordered creation/deletion                    â”‚  â”‚
#   â”‚  â”‚                  Pod Management: OrderedReady                 â”‚  â”‚
#   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
#   â”‚                             â”‚                                       â”‚
#   â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
#   â”‚           â”‚                 â”‚                 â”‚                     â”‚
#   â”‚           â–¼                 â–¼                 â–¼                     â”‚
#   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
#   â”‚  â”‚   Pod: web-0    â”‚ â”‚   Pod: web-1    â”‚ â”‚   Pod: web-2    â”‚      â”‚
#   â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚      â”‚
#   â”‚  â”‚   Ordinal: 0    â”‚ â”‚   Ordinal: 1    â”‚ â”‚   Ordinal: 2    â”‚      â”‚
#   â”‚  â”‚   IP: 10.244.0.5â”‚ â”‚   IP: 10.244.0.6â”‚ â”‚   IP: 10.244.0.7â”‚      â”‚
#   â”‚  â”‚   DNS:          â”‚ â”‚   DNS:          â”‚ â”‚   DNS:          â”‚      â”‚
#   â”‚  â”‚   web-0.nginx-  â”‚ â”‚   web-1.nginx-  â”‚ â”‚   web-2.nginx-  â”‚      â”‚
#   â”‚  â”‚   service       â”‚ â”‚   service       â”‚ â”‚   service       â”‚      â”‚
#   â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
#   â”‚  â”‚   â”‚  nginx   â”‚  â”‚ â”‚   â”‚  nginx   â”‚  â”‚ â”‚   â”‚  nginx   â”‚  â”‚      â”‚
#   â”‚  â”‚   â”‚  :80 â—„â”€â”€â”€â”¼â”€â”€â”¼â”€â”¼â”€â”€â”€â”¼â”€â”€:80 â—„â”€â”€â”€â”¼â”€â”€â”¼â”€â”¼â”€â”€â”€â”¼â”€â”€:80     â”‚  â”‚      â”‚
#   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
#   â”‚  â”‚   containerPort â”‚ â”‚   containerPort â”‚ â”‚   containerPort â”‚      â”‚
#   â”‚  â”‚   80 (web)      â”‚ â”‚   80 (web)      â”‚ â”‚   80 (web)      â”‚      â”‚
#   â”‚  â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚      â”‚
#   â”‚  â”‚   Volume Mount  â”‚ â”‚   Volume Mount  â”‚ â”‚   Volume Mount  â”‚      â”‚
#   â”‚  â”‚   /usr/share/   â”‚ â”‚   /usr/share/   â”‚ â”‚   /usr/share/   â”‚      â”‚
#   â”‚  â”‚   nginx/html    â”‚ â”‚   nginx/html    â”‚ â”‚   nginx/html    â”‚      â”‚
#   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
#   â”‚           â”‚                   â”‚                   â”‚                â”‚
#   â”‚           â–¼                   â–¼                   â–¼                â”‚
#   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
#   â”‚  â”‚  PVC: www-web-0 â”‚ â”‚  PVC: www-web-1 â”‚ â”‚  PVC: www-web-2 â”‚      â”‚
#   â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚      â”‚
#   â”‚  â”‚  Size: 1Gi      â”‚ â”‚  Size: 1Gi      â”‚ â”‚  Size: 1Gi      â”‚      â”‚
#   â”‚  â”‚  Access: RWO    â”‚ â”‚  Access: RWO    â”‚ â”‚  Access: RWO    â”‚      â”‚
#   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
#   â”‚           â”‚                   â”‚                   â”‚                â”‚
#   â”‚           â–¼                   â–¼                   â–¼                â”‚
#   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
#   â”‚  â”‚  PV (auto)      â”‚ â”‚  PV (auto)      â”‚ â”‚  PV (auto)      â”‚      â”‚
#   â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚      â”‚
#   â”‚  â”‚  1Gi storage    â”‚ â”‚  1Gi storage    â”‚ â”‚  1Gi storage    â”‚      â”‚
#   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
#   â”‚                                                                     â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#
#   REQUEST FLOW WITH PORTS
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   External Client (from another pod)
#        â”‚
#        â”‚ HTTP Request
#        â”‚ curl http://web-0.nginx-service:80
#        â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚  DNS Resolution                             â”‚
#   â”‚  web-0.nginx-service â†’ 10.244.0.5           â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#                         â”‚
#                         â”‚ Connect to 10.244.0.5:80
#                         â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚  Pod: web-0                                 â”‚
#   â”‚  IP: 10.244.0.5                             â”‚
#   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
#   â”‚  â”‚  Container: nginx                     â”‚  â”‚
#   â”‚  â”‚  Listening on: 0.0.0.0:80             â”‚  â”‚
#   â”‚  â”‚  containerPort: 80                    â”‚  â”‚
#   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#
#   PORT MAPPING EXPLAINED
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   Service Port (80):
#   â”œâ”€ The port exposed by the Service
#   â”œâ”€ Clients connect to this port
#   â””â”€ Example: curl http://web-0.nginx-service:80
#
#   Container Port (80):
#   â”œâ”€ The port the container listens on
#   â”œâ”€ Nginx listens on port 80 inside container
#   â””â”€ Must match the application's listening port
#
#   In this example:
#   â”œâ”€ Service port: 80 (what clients use)
#   â”œâ”€ Container port: 80 (what nginx listens on)
#   â””â”€ They match, so traffic flows directly
#
#   If they were different:
#   â”œâ”€ Service port: 8080 (client uses this)
#   â”œâ”€ Container port: 80 (nginx still listens on 80)
#   â””â”€ Service forwards 8080 â†’ 80 automatically
#
#
#   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
#   â•‘            YAML CONFIGURATION DIAGRAM (THIS FILE)                     â•‘
#   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   This diagram shows the actual YAML configuration in this file:
#
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚  HEADLESS SERVICE: nginx-service                                   â”‚
#   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
#   â”‚                                                                    â”‚
#   â”‚  apiVersion: v1                                                    â”‚
#   â”‚  kind: Service                                                     â”‚
#   â”‚  metadata:                                                         â”‚
#   â”‚    name: nginx-service  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
#   â”‚    labels:                        â”‚                                â”‚
#   â”‚      app: nginx                   â”‚                                â”‚
#   â”‚  spec:                            â”‚                                â”‚
#   â”‚    clusterIP: None  â—„â”€â”€â”€ Headless!â”‚                                â”‚
#   â”‚    selector:                      â”‚                                â”‚
#   â”‚      app: nginx  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
#   â”‚    ports:                         â”‚        â”‚                       â”‚
#   â”‚    - port: 80  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€ Service Port       â”‚
#   â”‚      name: web                    â”‚        â”‚                       â”‚
#   â”‚                                   â”‚        â”‚                       â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#                                       â”‚        â”‚
#                                       â”‚        â”‚ Matches pods with
#                                       â”‚        â”‚ label app=nginx
#                                       â”‚        â”‚
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚  STATEFULSET: web                 â”‚        â”‚                       â”‚
#   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
#   â”‚                                   â”‚        â”‚                       â”‚
#   â”‚  apiVersion: apps/v1              â”‚        â”‚                       â”‚
#   â”‚  kind: StatefulSet                â”‚        â”‚                       â”‚
#   â”‚  metadata:                        â”‚        â”‚                       â”‚
#   â”‚    name: web                      â”‚        â”‚                       â”‚
#   â”‚  spec:                            â”‚        â”‚                       â”‚
#   â”‚    serviceName: nginx-service â—„â”€â”€â”€â”˜        â”‚                       â”‚
#   â”‚    replicas: 3  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                       â”‚
#   â”‚    selector:                             â”‚ â”‚                       â”‚
#   â”‚      matchLabels:                        â”‚ â”‚                       â”‚
#   â”‚        app: nginx  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”˜                       â”‚
#   â”‚    template:                             â”‚                         â”‚
#   â”‚      metadata:                           â”‚                         â”‚
#   â”‚        labels:                           â”‚                         â”‚
#   â”‚          app: nginx  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
#   â”‚      spec:                                                         â”‚
#   â”‚        containers:                                                 â”‚
#   â”‚        - name: nginx                                               â”‚
#   â”‚          image: nginx:1.21                                         â”‚
#   â”‚          ports:                                                    â”‚
#   â”‚          - containerPort: 80  â—„â”€â”€â”€ Container listens on port 80    â”‚
#   â”‚            name: web                                               â”‚
#   â”‚          volumeMounts:                                             â”‚
#   â”‚          - name: www  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
#   â”‚            mountPath: /usr/share/nginx/html  â”‚                     â”‚
#   â”‚                                              â”‚                     â”‚
#   â”‚    volumeClaimTemplates:                     â”‚                     â”‚
#   â”‚    - metadata:                               â”‚                     â”‚
#   â”‚        name: www  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
#   â”‚      spec:                                                         â”‚
#   â”‚        accessModes: ["ReadWriteOnce"]                              â”‚
#   â”‚        resources:                                                  â”‚
#   â”‚          requests:                                                 â”‚
#   â”‚            storage: 1Gi  â—„â”€â”€â”€ Each pod gets 1Gi storage            â”‚
#   â”‚                                                                    â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#
#   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
#   â•‘              LABEL MATCHING EXPLAINED (IMPORTANT!)                    â•‘
#   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   ğŸ¯ THE QUESTION: How does the Service find the pods?
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   Answer: Through LABEL MATCHING!
#
#   The Service uses a SELECTOR to find pods with matching LABELS.
#
#
#   HOW IT WORKS:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   Step 1: Service defines a selector
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Service: nginx-service
#   spec:
#     selector:
#       app: nginx  â† Looking for pods with label "app=nginx"
#
#   Step 2: StatefulSet creates pods with labels
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   StatefulSet: web
#   template:
#     metadata:
#       labels:
#         app: nginx  â† Pods get this label
#
#   Step 3: Kubernetes matches them
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Service selector (app: nginx) == Pod label (app: nginx) âœ“ MATCH!
#
#
#   VISUAL MATCHING PROCESS:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚  Service: nginx-service                                         â”‚
#   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
#   â”‚  selector:                                                      â”‚
#   â”‚    app: nginx  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#                                       â”‚
#                                       â”‚ Kubernetes searches for pods
#                                       â”‚ with label app=nginx
#                                       â”‚
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚  ALL PODS IN NAMESPACE            â”‚                             â”‚
#   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚                             â”‚
#   â”‚                                   â”‚                             â”‚
#   â”‚  Pod: web-0                       â”‚                             â”‚
#   â”‚  labels:                          â”‚                             â”‚
#   â”‚    app: nginx  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ âœ“ MATCH! Service routes    â”‚
#   â”‚                                       traffic to this pod       â”‚
#   â”‚                                                                 â”‚
#   â”‚  Pod: web-1                                                     â”‚
#   â”‚  labels:                                                        â”‚
#   â”‚    app: nginx  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” âœ“ MATCH! Service routes    â”‚
#   â”‚                                   â”‚   traffic to this pod       â”‚
#   â”‚                                   â”‚                             â”‚
#   â”‚  Pod: web-2                       â”‚                             â”‚
#   â”‚  labels:                          â”‚                             â”‚
#   â”‚    app: nginx  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ âœ“ MATCH! Service routes    â”‚
#   â”‚                                       traffic to this pod       â”‚
#   â”‚                                                                 â”‚
#   â”‚  Pod: other-app-xyz                                             â”‚
#   â”‚  labels:                                                        â”‚
#   â”‚    app: other  âœ— NO MATCH! Service ignores this pod            â”‚
#   â”‚                                                                 â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#
#   RESULT:
#   â”€â”€â”€â”€â”€â”€â”€
#   Service "nginx-service" routes traffic to:
#   â”œâ”€ web-0 (has label app=nginx)
#   â”œâ”€ web-1 (has label app=nginx)
#   â””â”€ web-2 (has label app=nginx)
#
#   Service "nginx-service" IGNORES:
#   â””â”€ other-app-xyz (has label app=other, doesn't match)
#
#
#   WHY DOES THIS MATTER?
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   1. FLEXIBILITY:
#      You can have multiple pods with the same label
#      â””â”€ Service automatically includes all matching pods
#
#   2. DYNAMIC DISCOVERY:
#      When StatefulSet creates new pods (scaling up)
#      â””â”€ Service automatically discovers them (if labels match)
#
#   3. ISOLATION:
#      Pods without matching labels are ignored
#      â””â”€ You can have multiple apps in same namespace
#
#
#   MATCHING RULES:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   âœ“ MATCHES when ALL selector labels match pod labels:
#
#   Service selector:        Pod labels:
#   app: nginx          âœ“    app: nginx
#
#   Service selector:        Pod labels:
#   app: nginx          âœ“    app: nginx
#   tier: frontend           tier: frontend
#
#   Service selector:        Pod labels:
#   app: nginx          âœ“    app: nginx
#                            tier: frontend  â† Extra labels OK!
#                            version: v1
#
#
#   âœ— DOES NOT MATCH when ANY selector label is missing or different:
#
#   Service selector:        Pod labels:
#   app: nginx          âœ—    app: apache  â† Different value
#
#   Service selector:        Pod labels:
#   app: nginx          âœ—    tier: frontend  â† Missing app label
#   tier: frontend
#
#   Service selector:        Pod labels:
#   app: nginx          âœ—    (no labels)  â† No labels at all
#
#
#   PRACTICAL EXAMPLE:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   Scenario: You have 2 apps in the same namespace
#
#   App 1: Nginx (our StatefulSet)
#   â”œâ”€ web-0: labels { app: nginx }
#   â”œâ”€ web-1: labels { app: nginx }
#   â””â”€ web-2: labels { app: nginx }
#
#   App 2: Apache
#   â”œâ”€ apache-0: labels { app: apache }
#   â””â”€ apache-1: labels { app: apache }
#
#   Service: nginx-service
#   selector: { app: nginx }
#
#   Result:
#   â”œâ”€ Routes to: web-0, web-1, web-2 âœ“
#   â””â”€ Ignores: apache-0, apache-1 âœ“
#
#
#   TESTING LABEL MATCHING:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   # View pod labels
#   kubectl get pods --show-labels
#
#   # View pods matching a specific label
#   kubectl get pods -l app=nginx
#
#   # View service endpoints (shows which pods it found)
#   kubectl get endpoints nginx-service
#
#   # Describe service (shows selector and endpoints)
#   kubectl describe service nginx-service
#
#
#   COMMON MISTAKES:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   âŒ MISTAKE 1: Typo in label name
#   Service selector: app: nginx
#   Pod labels: ap: nginx  â† Typo! Won't match
#
#   âŒ MISTAKE 2: Typo in label value
#   Service selector: app: nginx
#   Pod labels: app: ngnix  â† Typo! Won't match
#
#   âŒ MISTAKE 3: Case sensitivity
#   Service selector: app: nginx
#   Pod labels: app: Nginx  â† Different case! Won't match
#
#   âŒ MISTAKE 4: Selector doesn't match template labels
#   StatefulSet selector: app: nginx
#   Pod template labels: app: apache  â† Won't create pods!
#
#
#   ğŸ’¡ BEST PRACTICE:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Always use the SAME label in three places:
#   1. Service selector
#   2. StatefulSet selector
#   3. Pod template labels
#
#   This ensures everything connects properly!
#

#   CREATES:
#   â”€â”€â”€â”€â”€â”€â”€â”€
#
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚  3 PODS (created sequentially)                                      â”‚
#   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
#   â”‚                                                                     â”‚
#   â”‚  Pod 1: web-0                                                       â”‚
#   â”‚  â”œâ”€ Hostname: web-0                                                 â”‚
#   â”‚  â”œâ”€ DNS: web-0.nginx-service.default.svc.cluster.local              â”‚
#   â”‚  â”œâ”€ IP: 10.244.0.5 (example)                                        â”‚
#   â”‚  â”œâ”€ Container: nginx:1.21                                           â”‚
#   â”‚  â”‚  â””â”€ Listening on: 0.0.0.0:80                                     â”‚
#   â”‚  â””â”€ PVC: www-web-0 (1Gi, ReadWriteOnce)                             â”‚
#   â”‚                                                                     â”‚
#   â”‚  Pod 2: web-1                                                       â”‚
#   â”‚  â”œâ”€ Hostname: web-1                                                 â”‚
#   â”‚  â”œâ”€ DNS: web-1.nginx-service.default.svc.cluster.local              â”‚
#   â”‚  â”œâ”€ IP: 10.244.0.6 (example)                                        â”‚
#   â”‚  â”œâ”€ Container: nginx:1.21                                           â”‚
#   â”‚  â”‚  â””â”€ Listening on: 0.0.0.0:80                                     â”‚
#   â”‚  â””â”€ PVC: www-web-1 (1Gi, ReadWriteOnce)                             â”‚
#   â”‚                                                                     â”‚
#   â”‚  Pod 3: web-2                                                       â”‚
#   â”‚  â”œâ”€ Hostname: web-2                                                 â”‚
#   â”‚  â”œâ”€ DNS: web-2.nginx-service.default.svc.cluster.local              â”‚
#   â”‚  â”œâ”€ IP: 10.244.0.7 (example)                                        â”‚
#   â”‚  â”œâ”€ Container: nginx:1.21                                           â”‚
#   â”‚  â”‚  â””â”€ Listening on: 0.0.0.0:80                                     â”‚
#   â”‚  â””â”€ PVC: www-web-2 (1Gi, ReadWriteOnce)                             â”‚
#   â”‚                                                                     â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   HOW TO ACCESS:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   From another pod in the same namespace:
#   â”œâ”€ curl http://web-0.nginx-service:80       (specific pod)
#   â”œâ”€ curl http://web-1.nginx-service:80       (specific pod)
#   â”œâ”€ curl http://web-2.nginx-service:80       (specific pod)
#   â””â”€ curl http://web-0.nginx-service          (port 80 is default for HTTP)
#
#   Full DNS names:
#   â”œâ”€ web-0.nginx-service.default.svc.cluster.local:80
#   â”œâ”€ web-1.nginx-service.default.svc.cluster.local:80
#   â””â”€ web-2.nginx-service.default.svc.cluster.local:80
#

#
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                      4. POD CREATION FLOW                                 â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   SEQUENTIAL POD CREATION (podManagementPolicy: OrderedReady)
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   kubectl apply -f statefulset-simple.yaml
#           â”‚
#           â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚ Create Headless   â”‚
#   â”‚ Service           â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#           â”‚
#           â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚ Create StatefulSetâ”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#           â”‚
#           â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚ Step 1: Create web-0                                          â”‚
#   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
#   â”‚ â€¢ Create PVC: www-web-0 (1Gi)                                 â”‚
#   â”‚ â€¢ Wait for PVC to be Bound                                    â”‚
#   â”‚ â€¢ Create Pod: web-0                                           â”‚
#   â”‚ â€¢ Mount volume to /usr/share/nginx/html                       â”‚
#   â”‚ â€¢ Wait for Pod to be Ready (Running + Readiness probe passes) â”‚
#   â”‚ â€¢ Register DNS: web-0.nginx-service.default.svc.cluster.local â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#           â”‚
#           â”‚ âœ“ web-0 is Ready
#           â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚ Step 2: Create web-1                                          â”‚
#   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
#   â”‚ â€¢ Create PVC: www-web-1 (1Gi)                                 â”‚
#   â”‚ â€¢ Wait for PVC to be Bound                                    â”‚
#   â”‚ â€¢ Create Pod: web-1                                           â”‚
#   â”‚ â€¢ Mount volume to /usr/share/nginx/html                       â”‚
#   â”‚ â€¢ Wait for Pod to be Ready                                    â”‚
#   â”‚ â€¢ Register DNS: web-1.nginx-service.default.svc.cluster.local â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#           â”‚
#           â”‚ âœ“ web-1 is Ready
#           â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚ Step 3: Create web-2                                          â”‚
#   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
#   â”‚ â€¢ Create PVC: www-web-2 (1Gi)                                 â”‚
#   â”‚ â€¢ Wait for PVC to be Bound                                    â”‚
#   â”‚ â€¢ Create Pod: web-2                                           â”‚
#   â”‚ â€¢ Mount volume to /usr/share/nginx/html                       â”‚
#   â”‚ â€¢ Wait for Pod to be Ready                                    â”‚
#   â”‚ â€¢ Register DNS: web-2.nginx-service.default.svc.cluster.local â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#           â”‚
#           â”‚ âœ“ All pods Ready
#           â–¼
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚ StatefulSet Ready â”‚
#   â”‚ 3/3 replicas      â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   SCALING UP (kubectl scale statefulset web --replicas=5)
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   web-3 created â†’ Wait for Ready â†’ web-4 created
#
#   SCALING DOWN (kubectl scale statefulset web --replicas=1)
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   web-2 deleted â†’ Wait for termination â†’ web-1 deleted
#   (Reverse order: highest ordinal first)
#
#
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                   5. DNS AND NETWORK IDENTITY                             â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   STABLE DNS NAMES
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   Each pod gets a predictable DNS name:
#
#   Format: <pod-name>.<service-name>.<namespace>.svc.cluster.local
#
#   Examples:
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€
#   Pod: web-0
#   â”œâ”€ Hostname: web-0
#   â”œâ”€ Short DNS: web-0.nginx-service
#   â”œâ”€ Full DNS: web-0.nginx-service.default.svc.cluster.local
#   â””â”€ IP: 10.244.0.10 (example)
#
#   Pod: web-1
#   â”œâ”€ Hostname: web-1
#   â”œâ”€ Short DNS: web-1.nginx-service
#   â”œâ”€ Full DNS: web-1.nginx-service.default.svc.cluster.local
#   â””â”€ IP: 10.244.0.11 (example)
#
#   Pod: web-2
#   â”œâ”€ Hostname: web-2
#   â”œâ”€ Short DNS: web-2.nginx-service
#   â”œâ”€ Full DNS: web-2.nginx-service.default.svc.cluster.local
#   â””â”€ IP: 10.244.0.12 (example)
#
#   DNS RESOLUTION FROM OTHER PODS
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   From another pod in same namespace:
#   â”œâ”€ nslookup web-0.nginx-service
#   â”‚  â””â”€ Returns: 10.244.0.10
#   â”‚
#   â”œâ”€ nslookup web-1.nginx-service
#   â”‚  â””â”€ Returns: 10.244.0.11
#   â”‚
#   â””â”€ curl http://web-0.nginx-service
#      â””â”€ Connects directly to web-0 pod
#
#   HEADLESS SERVICE DNS
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   Service: nginx-service (clusterIP: None)
#   â”œâ”€ nslookup nginx-service
#   â”‚  â””â”€ Returns ALL pod IPs:
#   â”‚     â”œâ”€ 10.244.0.10 (web-0)
#   â”‚     â”œâ”€ 10.244.0.11 (web-1)
#   â”‚     â””â”€ 10.244.0.12 (web-2)
#   â”‚
#   â””â”€ No load balancing (headless)
#      â””â”€ Client chooses which pod to connect to
#
#
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                      6. PERSISTENT STORAGE                                â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
#   AUTOMATIC PVC CREATION
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   StatefulSet creates one PVC per pod using volumeClaimTemplates:
#
#   Template: www
#   â”œâ”€ Size: 1Gi
#   â””â”€ AccessMode: ReadWriteOnce
#
#   Created PVCs:
#   â”œâ”€ www-web-0 â†’ Bound to web-0
#   â”œâ”€ www-web-1 â†’ Bound to web-1
#   â””â”€ www-web-2 â†’ Bound to web-2
#
#   Naming Pattern: <template-name>-<pod-name>
#
#   PERSISTENCE ACROSS POD RESTARTS
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   Scenario: Delete web-0
#   â”œâ”€ kubectl delete pod web-0
#   â”‚
#   â”œâ”€ Pod web-0 is deleted
#   â”‚  â””â”€ PVC www-web-0 remains (NOT deleted)
#   â”‚
#   â”œâ”€ StatefulSet recreates pod web-0
#   â”‚  â”œâ”€ Same name: web-0
#   â”‚  â”œâ”€ Same DNS: web-0.nginx-service
#   â”‚  â””â”€ Same PVC: www-web-0 (reattached)
#   â”‚
#   â””â”€ Data persists! Files in /usr/share/nginx/html are intact
#
#   STORAGE LIFECYCLE
#   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#
#   Create StatefulSet:
#   â””â”€ PVCs created automatically
#
#   Delete StatefulSet:
#   â”œâ”€ Pods deleted
#   â””â”€ PVCs remain (manual cleanup required)
#      â””â”€ kubectl delete pvc www-web-0 www-web-1 www-web-2
#
#   Why? Prevents accidental data loss!
#
#
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                 7. HEADLESS SERVICE CONFIGURATION                         â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# A headless service is REQUIRED for StatefulSets to provide stable DNS names
#
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
  labels:
    app: nginx
spec:
  # Port exposed by the service
  ports:
    - port: 80 # Service port
      name: web # Named port (optional but recommended)
      # targetPort: 80  # Pod port (defaults to same as port)
      # protocol: TCP   # Protocol (default: TCP)

  # clusterIP: None makes this a HEADLESS service
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # â€¢ No virtual IP assigned
  # â€¢ No load balancing
  # â€¢ DNS returns individual pod IPs
  # â€¢ Required for StatefulSet stable network identity
  clusterIP: None

  # Selector: Matches pods with label app=nginx
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # This service will create DNS entries for all pods
  # that have the label app=nginx
  selector:
    app: nginx

---
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                   8. STATEFULSET CONFIGURATION                            â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
apiVersion: apps/v1
kind: StatefulSet
metadata:
  # StatefulSet name: web
  # Pods will be named: web-0, web-1, web-2, etc.
  name: web

  # Labels for the StatefulSet itself (optional)
  labels:
    app: nginx
    tier: frontend

spec:
  # serviceName: MUST match the headless service name
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # This links the StatefulSet to the headless service
  # Used for DNS name generation
  serviceName: "nginx-service"

  # replicas: Number of desired pods
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # Creates pods: web-0, web-1, web-2
  replicas: 3

  # podManagementPolicy: Controls pod creation/deletion order
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # OrderedReady (default):
  #   â€¢ Creates pods sequentially: web-0 â†’ web-1 â†’ web-2
  #   â€¢ Waits for each pod to be Ready before creating next
  #   â€¢ Deletes in reverse order: web-2 â†’ web-1 â†’ web-0
  #   â€¢ Use for: Databases, distributed systems requiring order
  #
  # Parallel:
  #   â€¢ Creates all pods simultaneously (like Deployment)
  #   â€¢ Faster startup, but no ordering guarantee
  #   â€¢ Use for: Apps that don't need strict ordering
  podManagementPolicy: OrderedReady

  # selector: Identifies which pods belong to this StatefulSet
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # Must match the labels in template.metadata.labels
  selector:
    matchLabels:
      app: nginx

  # template: Pod template (same as in Deployment)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  template:
    metadata:
      # Labels applied to each pod
      # Must match selector.matchLabels above
      labels:
        app: nginx
        # Additional labels (optional)
        version: v1
        environment: production

    spec:
      # terminationGracePeriodSeconds: Time to wait before force-killing pod
      # (default: 30 seconds, good for graceful shutdown)
      terminationGracePeriodSeconds: 10

      # Init container: Runs before main container
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Creates default index.html if it doesn't exist
      # This prevents nginx from returning 403 on empty volume
      initContainers:
        - name: init-html
          image: busybox:1.35
          command:
            - sh
            - -c
            - |
              if [ ! -f /usr/share/nginx/html/index.html ]; then
                echo "<h1>Welcome to $(hostname)</h1>" > /usr/share/nginx/html/index.html
                echo "<p>This is a StatefulSet pod</p>" >> /usr/share/nginx/html/index.html
                echo "Created index.html for $(hostname)"
              else
                echo "index.html already exists"
              fi
          volumeMounts:
            - name: www
              mountPath: /usr/share/nginx/html

      containers:
        - name: nginx
          # Container image
          image: nginx:1.21

          # Image pull policy
          # Always: Pull image every time
          # IfNotPresent: Pull only if not cached (default)
          # Never: Never pull, use local only
          imagePullPolicy: IfNotPresent

          # Container ports
          ports:
            - containerPort: 80
              name: web # Named port (matches service)
              protocol: TCP # TCP or UDP

          # Volume mounts: Where to mount volumes in container
          # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          volumeMounts:
            - name: www # Must match volume name below
              mountPath: /usr/share/nginx/html # Mount point in container
              # subPath: ""                       # Optional: Mount subdirectory
              # readOnly: false                   # Optional: Read-only mount

          # Resource requests and limits (recommended)
          # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          resources:
            requests:
              cpu: 100m # 0.1 CPU cores
              memory: 128Mi # 128 mebibytes
            limits:
              cpu: 500m # 0.5 CPU cores max
              memory: 512Mi # 512 mebibytes max

          # Liveness probe: Checks if container is alive
          # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          # If fails: Container is restarted
          livenessProbe:
            httpGet:
              path: /
              port: 80
            initialDelaySeconds: 30 # Wait 30s before first check
            periodSeconds: 10 # Check every 10s
            timeoutSeconds: 5 # Timeout after 5s
            failureThreshold: 3 # Restart after 3 failures

          # Readiness probe: Checks if container is ready to serve traffic
          # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          # If fails: Pod removed from service endpoints (no traffic)
          readinessProbe:
            httpGet:
              path: /
              port: 80
            initialDelaySeconds: 5 # Wait 5s before first check
            periodSeconds: 5 # Check every 5s
            timeoutSeconds: 3 # Timeout after 3s
            failureThreshold: 3 # Mark unready after 3 failures

  # volumeClaimTemplates: Template for creating PVCs
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # StatefulSet creates one PVC per pod using this template
  # PVCs are named: <template-name>-<pod-name>
  # Example: www-web-0, www-web-1, www-web-2
  volumeClaimTemplates:
    - metadata:
        name: www # Template name (used in volumeMounts above)

        # Labels for PVCs (optional)
        labels:
          app: nginx
          type: storage

      spec:
        # accessModes: How the volume can be mounted
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # ReadWriteOnce (RWO): Mount read-write by single node
        # ReadOnlyMany (ROX): Mount read-only by many nodes
        # ReadWriteMany (RWX): Mount read-write by many nodes
        accessModes: ["ReadWriteOnce"]

        # storageClassName: Type of storage to provision
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # If not specified, uses default StorageClass
        # Examples: standard, ssd, fast, slow
        # storageClassName: standard

        # resources: Storage size request
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        resources:
          requests:
            storage: 1Gi # 1 gibibyte per pod


        # selector: Select existing PVs (optional)
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # If specified, binds to existing PV matching labels
        # If not specified, dynamically provisions new PV
        # selector:
        #   matchLabels:
        #     type: fast-ssd
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                       9. USEFUL KUBECTL COMMANDS                          â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# DEPLOYMENT:
#   kubectl apply -f statefulset-simple.yaml
#   kubectl delete -f statefulset-simple.yaml
#
# VIEWING:
#   kubectl get statefulset
#   kubectl get sts                          # Short name
#   kubectl get sts web -o wide
#   kubectl describe statefulset web
#
# PODS:
#   kubectl get pods -l app=nginx
#   kubectl get pods -l app=nginx -o wide    # Shows node, IP
#   kubectl get pods -w                      # Watch mode
#
# PERSISTENT VOLUMES:
#   kubectl get pvc                          # View PVCs
#   kubectl get pv                           # View PVs
#   kubectl describe pvc www-web-0
#
# SCALING:
#   kubectl scale statefulset web --replicas=5    # Scale up
#   kubectl scale statefulset web --replicas=1    # Scale down
#
# UPDATING:
#   kubectl set image statefulset/web nginx=nginx:1.22
#   kubectl rollout status statefulset/web
#   kubectl rollout history statefulset/web
#
# DNS TESTING:
#   kubectl run -it --rm debug --image=busybox --restart=Never -- sh
#   # Inside debug pod:
#   nslookup web-0.nginx-service
#   nslookup web-1.nginx-service
#   nslookup nginx-service              # Returns all pod IPs
#   wget -O- http://web-0.nginx-service
#
# PERSISTENCE TESTING:
#   # Write data to web-0
#   kubectl exec web-0 -- sh -c 'echo "Hello from web-0" > /usr/share/nginx/html/index.html'
#
#   # Read data
#   kubectl exec web-0 -- cat /usr/share/nginx/html/index.html
#
#   # Delete pod
#   kubectl delete pod web-0
#
#   # Wait for recreation
#   kubectl wait --for=condition=ready pod/web-0 --timeout=60s
#
#   # Verify data persisted
#   kubectl exec web-0 -- cat /usr/share/nginx/html/index.html
#   # Still shows: "Hello from web-0"
#
# CLEANUP:
#   kubectl delete statefulset web
#   kubectl delete service nginx-service
#   kubectl delete pvc www-web-0 www-web-1 www-web-2    # Manual PVC cleanup
#
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                           BEST PRACTICES                                  â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# âœ… DO:
# â”€â”€â”€â”€â”€
# â€¢ Always use headless service (clusterIP: None)
# â€¢ Set resource requests and limits
# â€¢ Use readiness and liveness probes
# â€¢ Set podManagementPolicy based on your needs
# â€¢ Use volumeClaimTemplates for persistent storage
# â€¢ Plan for PVC cleanup (not auto-deleted)
#
# âŒ DON'T:
# â”€â”€â”€â”€â”€â”€â”€â”€â”€
# â€¢ Don't use StatefulSet for stateless apps (use Deployment)
# â€¢ Don't delete PVCs unless you want to lose data
# â€¢ Don't scale down to 0 if you need data persistence
# â€¢ Don't use StatefulSet if you don't need stable identity
#
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘                           RELATED FILES                                   â•‘
# â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
# â•‘  â€¢ deployment.yaml       - For stateless applications                    â•‘
# â•‘  â€¢ service-clusterip.yaml - For load-balanced services                   â•‘
# â•‘  â€¢ persistentvolume.yaml  - For manual PV/PVC management                 â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
